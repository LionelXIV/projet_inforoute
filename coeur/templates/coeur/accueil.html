{% extends 'base.html' %}

{% block title %}Accueil - DataQC{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="p-4">
            <h1 class="display-4">Bienvenue sur DataQC</h1>
            <p class="lead">Plateforme de moissonnage et d'exposition des donn√©es ouvertes du Qu√©bec</p>
            <hr class="my-4">
            <p>Cette plateforme Django permet de moissonner des m√©tadonn√©es depuis Donn√©es Qu√©bec pour les exposer via des API REST et GraphQL.</p>
        </div>
    </div>
</div>

<div class="row mt-5">
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">üè¢ Organisations</h5>
                <h2 class="text-primary">{{ nombre_organisations }}</h2>
                <p class="card-text">Organisations moissonn√©es</p>
                <a href="/moissonnage/" class="btn btn-outline-primary">Moissonner</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">üìä Jeux de donn√©es</h5>
                <h2 class="text-success">{{ nombre_jeux_donnees }}</h2>
                <p class="card-text">Jeux de donn√©es disponibles</p>
                <a href="/admin/" class="btn btn-outline-success">Voir admin</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">üìÅ Ressources</h5>
                <h2 class="text-info">{{ nombre_ressources }}</h2>
                <p class="card-text">Fichiers de donn√©es</p>
                <a href="/api/organisations/" class="btn btn-outline-info">Voir API</a>
            </div>
        </div>
    </div>
</div>

<div class="row mt-5">
    <div class="col-12">
        <h2>Source de donn√©es</h2>
        <p>Cette plateforme moissonne des donn√©es depuis :</p>
        <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between align-items-center">
                Donn√©es Qu√©bec
                <span class="badge bg-success rounded-pill">Actif</span>
            </li>
        </ul>
    </div>
</div>

<!-- Statistiques avanc√©es -->
<div class="row mt-5">
    <div class="col-12">
        <h2 class="mb-4">üìä Statistiques d√©taill√©es</h2>
    </div>
</div>

<!-- R√©partition th√©matique (Cat√©gories) -->
<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">R√©partition th√©matique</h5>
            </div>
            <div class="card-body">
                <canvas id="chartCategories" height="300"></canvas>
                {% if not repartition_categories %}
                    <p class="text-muted mt-3">Aucune cat√©gorie disponible pour le moment.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Tendances temporelles -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">Tendances temporelles - Jeux de donn√©es cr√©√©s par mois (12 derniers mois)</h5>
            </div>
            <div class="card-body">
                <canvas id="chartTendances" height="100"></canvas>
                {% if not tendances_temporelles %}
                    <p class="text-muted mt-3">Aucune donn√©e disponible pour le moment.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

<script>
// Graphique camembert - Cat√©gories
{% if repartition_categories %}
const ctxCategories = document.getElementById('chartCategories').getContext('2d');
const chartCategories = new Chart(ctxCategories, {
    type: 'pie',
    data: {
        labels: {{ categories_labels|safe }},
        datasets: [{
            label: 'Nombre de jeux',
            data: {{ categories_values|safe }},
            backgroundColor: [
                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384'
            ]
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false
    }
});
{% endif %}

// Graphique ligne - Tendances temporelles
{% if tendances_temporelles %}
const ctxTendances = document.getElementById('chartTendances').getContext('2d');
const chartTendances = new Chart(ctxTendances, {
    type: 'line',
    data: {
        labels: {{ tendances_labels|safe }},
        datasets: [{
            label: 'Jeux de donn√©es cr√©√©s',
            data: {{ tendances_values|safe }},
            borderColor: '#36A2EB',
            backgroundColor: 'rgba(54, 162, 235, 0.1)',
            tension: 0.4,
            fill: true
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
{% endif %}
</script>
{% endblock %}
